NK Notifications
================

Overview
--------
This is a stand alone command line application which makes it easy to send notifications to users from application integrated with nk.pl.
All you need is:
* a PHP with cURL and PECL installed, 
* API credentials which your application uses for usual REST requests and signatures (obtained from nk.pl),
* Message body, link title and link params to include in each message,
* A list of `person.id`s of recipients


This project is havily based on :
* http://oauth.googlecode.com/svn/code/php
* https://github.com/qbolec/PHP-Framework

Installation
------------
Download the contents of this repo. That's it.

Just make sure you have PHP with Curl installed, by running:
`php -i | grep -i curl`
The output should be something like:
```
Additional .ini files parsed => /etc/php5/cli/conf.d/curl.ini,
curl
cURL support => enabled
cURL Information => 7.18.2
```

Configuration
-------------
In the file nk-notifications/include/Config.php you need to provide three pieces of information,
which you can easily find at https://developers.nk.pl/developers in your apps settings:

* Id of your application (this is small integer number which you can find in app's settings page at the top)
* OAuth's Key for your application (this can be found in  "Additional Settings" section of app's settings page - actually it is something that the developer provides, so you should already know that)
* OAuth's Secret for your application (this can be found near the OAuth's Key, and is automatically generated by nk.pl and should be kept secret) 

Until you provide real data for these three settings (i.e. nk/app_id nk/oauth/key and nk/oauth/secret) the script will be unable to authenticate your requests and thus it will not work. 

Running
-------
Once the Config.php is properly configured for your app, you can send notifications like this:
```
php send_notification.php --body [TEXT MESSAGE] --title [LINK TITLE] --query_string [URL PARAMS] --send [yes/no] 
```
and feed ids of persons to STDIN. For example:
```
php send_notification.php --body 'You need to milk the cow!' --title 'Milk it!' --query_string 'action=milk&source=notification' --send yes <<< "person.123456"
```

You can provide as many person ids as you want - one in each line, this makes it supper easy to send bulk of thousands of messages with a single run of the script - for example:
```
mysql --skip-column-names <<< "SELECT person_id FROM users" | 
php send_notification.php --body 'X-Mass offer is here!' --title 'Visit Shop!' --query_string 'action=shop&source=ad' --send yes
```

The `--body` controls the "black" text of the notification. The `--title` is the "blue" fragment which is the link to your application. 

Use `--query_string` to provide extra url parameters which will be forwarded to your game/application when user clicks the link, so that you can react accordingly.

Use `--send no` if you just want to perform a "dry run" - the command arguments will be verified, but no actuall notification will be sent to anyone.

Use `--send yes` once you are sure what you are doing.
